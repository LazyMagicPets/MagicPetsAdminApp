@namespace BlazorUI
@inherits LzLayoutComponentBaseInjectViewModel<ISessionsViewModel>
@inject IJSRuntime JSRuntime
@inject ILzHost Host
@*
    This component instantiates the ISessionsViewModel singleton.
    However, Maui Hybrid and WASM apps do not setup the DI context exactly the same way. 
    In MAUI, it is necessary to pass the JSRuntime into classes that are not UI components. 
    This is done in the Init.razor page. Once this is done, the SessionsViewModel.IsInitialized
    property is set to true.

    Any child components, like NavMenu below, must be aware of the SessionsViewModel 
    initialization lifecycle and operate property before and after initialization. 
*@

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudLayout>
	<MudAppBar>
		<MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
	</MudAppBar>
	<MudDrawer @bind-Open="_drawerOpen">
		<MudNavMenu>
			@if (ViewModel!.IsInitialized)
			{
				<MudNavLink Href="/HomePage"><MudIcon Icon="@Icons.Material.Filled.Home" />Home</MudNavLink>
                @if(ViewModel!.IsSignedIn)
                {
                    @if(ViewModel!.IsAdmin)
                    {
                        <MudNavLink Href="/AdminPage">Admin</MudNavLink>
                    }
                    <MudNavLink Href="/UsersPage">Users</MudNavLink>
                }
            }
		</MudNavMenu>
	</MudDrawer>
	<MudMainContent Class="d-flex align-start">
        @Body
	</MudMainContent>
</MudLayout>

@code {
    [Parameter] public string Title { get; set; } = "";

    private string tenancyHostUrl = string.Empty;

    private string? tenancyName = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        tenancyName = ViewModel?.TenancyConfig?["tenantName"]?.ToString();

        await base.OnAfterRenderAsync(firstRender);
    }

    private bool _drawerOpen = true;
    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
}